<#include "../../inc/layout.html">
<@layout title="出库入库" js="scm/storageBill/checkStorage.js">
<style>
    body{background: #fff;}
    #prodcutTable .ui-input{width:100%;}
    .comboDiv{position:absolute;left:94px;}
    .comboDiv ul li{margin:2px; }
    .table .comboDiv{position:absolute;left:133px;}
    .table tbody tr td{padding:0px;}
    .table tbody tr td .ui-input{width:100%;height:34px;}
    .table tbody tr .tdPd{padding:8px;}
    .table1 td{padding:2px;}


    .default {
        background-color: white;
    }
    .over {
        background-color: red; /* pale yellow for odd rows */
    }
    .LessThan {
        background-color: greenyellow; /* pale blue for even rows */
    }
    .equal {
        background-color: yellow; /* pale blue for even rows */
    }
    .add {
        background-color: #5CACEE; /* pale blue for even rows */
    }
</style>
<div class="manage-wrapper" ms-controller="ctrl" style="overflow: scroll;overflow-x: hidden;height: 100%;width:99%">
    <div class="manage-wrap">
        <form action=""id="base_form">
            <table style="width:100%;" class="table1">
                <tr>
                    <td width="100px" align="right">仓库：</td>
                    <td width="20%">
                        <select ms-duplex="data.depot_id" class="ui-input" style="width:100px" data-msg="调出仓库必选" data-rule="required">
                            <option ms-repeat="depotList" ms-value="el.id">{{el.name}}</option>
                        </select>
                        <span ms-if="fillOrder">{{billType[data.type]}}</span>
                        <select ms-duplex="data.type" class="ui-input" style="width:100px;" ms-if="fillOrder==false">
                            <option ms-repeat="billType" ms-value="$index">{{el}}</option>
                        </select>
                    </td>
                    <td width="100px" align="right">单据日期：</td>
                    <td width="20%"><input id="sign_date" class="ui-input ui-datepicker-input" style="width:100px;" ms-duplex="data.bill_date" data-msg="单据日期" data-rule="required;"></td>
                    <td width="100px;" align="right">单据编号：</td>
                    <td width="20%">{{data.billsn}}</td>
                </tr>
                <tr>
                    <td align="right">负责人：</td>
                    <td><select ms-duplex="data.head_id" class="ui-input" style="width:220px;" data-rule="required" data-msg="请选择负责人">
                        <option></option>
                        <option ms-repeat="userList" ms-value="el.id">{{el.realname}}({{el.department_name}}-{{el.position_name}})</option>
                    </select></td>
                    <td ms-if="fillOrder" align="right">业务单：</td>
                    <td ms-if="fillOrder">
                        {{data.ordersn}}
                    </td>
                </tr>
            </table>
            </ul>
            <br>

            <ul class="ul-inline">
                <li>
                    <div class="row">
                        <div class="input-group" style="padding-left: 20px;">
                            <label>条码:</label>
                            <input type="hidden" ms-duplex="query.keyBar" class="ui-input" id="barCodeCheck">
                            <input type="text" ms-duplex="query.keyName" class="ui-input" id="productNameCheck">
                            <label>数量:</label>
                            <input type="text" ms-duplex="query.keynum" class="ui-input" value="" id="keynum"
                                   placeholder="请输入数量">
                            <label>单位:</label>
                            <select ms-duplex="data.comparison" class="ui-input" style="width: auto" id="comparison">
                                <option ms-repeat="comparison" ms-value="el.comparison_num">{{el.comparison_unit}}
                                </option>
                            </select>
                            <a class="ui-btn" id="okIndex">添加</a>
                            <a class="ui-btn" id="search" title="选择产品"><i class="fa fa-search"></i></a>
                            <label for="model" style="vertical-align:middle;"><input onchange="changeModel(this)" type="checkbox" style="vertical-align:middle;" value="" id="model">条码枪模式</label>
                            <a class="ui-btn" id="allCheck">全部校验</a>
                            <div class="input-group-btn">
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right" style="left:auto" role="menu">
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>

            <table class="table table_thead_fixed table-bordered table-condensed" id="prodcutTable">
                <thead>
                <tr>
                    <th width="50px">&nbsp;</th>
                    <th>条形码</th>
                    <th>商品</th>
                    <th width="55px">单位</th>
                    <th>单价</th>
                    <th>数量</th>
                    <th>实际数量</th>
                    <th>差异数量</th>
                    <th>实际金额</th>
                    <th>备注</th>
                </tr>
                </thead>
                <tbody style="max-height:400px;">
                <tr ms-repeat="data.productlist" class="productTr" ms-dblclick="changePrice(el)">
                    <td width="50px" class="tdPd">{{$index+1}}</td>
                    <#--<td width="50px" class="tdPd"><nobr><i class="fa fa-plus mrb" ms-click="addRow" title="移除"></i><i class="fa fa-trash mrb" ms-click="delRow" title="移除"></i></nobr></td>-->
                    <#--<td>-->
                        <#--<input type="text"class="ui-input" ms-attr-id="ix{{$index}}" ms-keyup="qryProduct(this.value,$index)"ms-click="qryProduct(this.value,$index)"-->
                               <#--ms-duplex="el.product_name" data-rule="required;" data-msg="请选择商品">-->
                        <#--<div class="comboDiv" style="width:260px;"ms-visible="productComboDiv==$index">-->
                            <#--<ul>-->
                                <#--<li ms-repeat="productlist" ms-click="chooseProduct(el,productComboDiv)">{{el.billsn}}&nbsp;&nbsp;{{el.product_name}}</li>-->
                            <#--</ul>-->
                        <#--</div></td>-->
                    <#--<td><input class="ui-input" ms-duplex="el.product_name" data-msg="数量必填且为数字！"></td>-->
                    <td class="tdPd">{{el.billsn}}</td>
                    <td class="tdPd">{{el.product_name}}</td>
                    <td class="tdPd">{{el.unit|custParame}}</td>
                    <td class="tdPd">
                        <input ms-duplex="el.price" ms-change="priceChange(el)">
                    </td>
                    <td class="tdPd">{{el.amount}}</td>
                    <td class="tdPd">
                        <input ms-duplex="el.realAmount" ms-change="amountChange(el)">
                    </td>
                    <td class="tdPd">{{el.differenceAmount}}</td>
                    <td class="tdPd">{{el.realPrice}}</td>
                    <#--<td><input class="ui-input" ms-attr-id="id3{{$index}}"data-rule="required;number" ms-duplex="el.amount" data-msg="数量必填且为数字！" ms-change="jisuan"></td>-->
                    <#--<td><input class="ui-input" ms-duplex="el.realAmount" data-msg="数量必填且为数字！"></td>-->
                    <#--<td><input class="ui-input" ms-duplex="el.differenceAmount" data-msg="数量必填且为数字！"></td>-->
                    <td><input class="ui-input" ms-attr-id="id1{{$index}}" ms-duplex="el.remark"></td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="5" align="right">合计</td>
                    <td>{{totalAmount}}</td>
                    <td>{{totalAmountReal}}</td>
                    <td>{{totalAmountDifference}}</td>
                    <td>{{totalAmountPrice|money}}</td>
                    <td></td>
                </tr>
                </tfoot>
            </table>
            <div>
                <p>
                    备注：
                    <br>
                    <textarea ms-duplex="data.remark" id="remark" class="ui-input" style="height:100px;width:100%;"></textarea>
                </p>
            </div>
        </form>
    </div>
</div>
</@layout>